---
title: "HW 02 - Airbnb listings in Edinburgh"
author: "Max Asmar"
output: 
  tufte::tufte_html:
    css: ../lab.css
    tufte_variant: "envisioned"
    highlight: pygments
  tufte::tufte_handout:
    latex_engine: xelatex
    highlight: pygments
    keep_tex: true
    citation_package: natbib
link-citations: true
---

```{r include = FALSE}
knitr::opts_chunk$set(
  eval = FALSE,
  out.width = "80%",
  fig.asp = 0.618,
  fig.width = 6
)
```

```{r photo, fig.margin = TRUE, echo = FALSE, fig.width = 3, fig.cap = "Photo by Madeleine Kohler on Unsplash", eval = TRUE}
knitr::include_graphics("img/madeleine-kohler-90Qn643Pq9c-unsplash.jpg")
```

Once upon a time, people traveled all over the world, and some stayed in hotels and others chose to stay in other people's houses that they booked through Airbnb. Recent developments in Edinburgh regarding the growth of Airbnb and its impact on the housing market means a better understanding of the Airbnb listings is needed. Using data provided by Airbnb, we can explore how Airbnb availability and prices vary by neighborhood.

# Getting started

## Learning Objectives

In this assignment, you will practice:

- Creating visualizations with `ggplot2`
- Using faceting to compare distributions across groups
- Working with pipelines to filter and summarize data
- Interpreting distributions using visualizations and summary statistics
- Choosing appropriate visualization types for different questions

---

Navigate to your `homework-instructions` repo in JupyterHub and open the `hw-02-airbnb-edi.Rmd` file. Knit the document to make sure it compiles without errors.

## Warm up

Before we introduce the data, let's warm up with some simple exercises.

**Complete these steps:**

1. Update the YAML, changing the author name to your name
2. **Knit** the document
3. **Commit** your changes with message: `"Updated author name"`
4. **Push** to GitHub
5. Verify your changes are visible in your GitHub repo (check both .Rmd and .md files)

If anything is missing, commit and push again.

## Packages

We'll use the **tidyverse** package for much of the data wrangling and visualization and the data lives in the **dsbox** package. These packages are already installed for you. You can load them by running the following in your Console:

```{r load-packages, eval = TRUE, warning = FALSE, message = FALSE}
library(tidyverse)
library(dsbox)
```

**Note:** If you get an error that dsbox is not installed, run this in your Console first:

```{r eval = FALSE}
install.packages("devtools")
devtools::install_github("tidyverse/dsbox")
```

## Data

The data can be found in the **dsbox** package, and it's called `edibnb`. Since the dataset is distributed with the package, we don't need to load it separately; it becomes available to us when we load the package.

You can view the dataset as a spreadsheet using the `View()` function. Note that you should not put this function in your R Markdown document, but instead type it directly in the Console, as it pops open a new window (and the concept of popping open a window in a static document doesn't really make sense...). When you run this in the console, you'll see the following **data viewer** window pop up.

```{r view-data}
View(edibnb)
```

You can find out more about the dataset by inspecting its documentation, which you can access by running `?edibnb` in the Console or using the Help menu in RStudio to search for `edibnb`. You can also find this information [here](https://rstudio-education.github.io/dsbox/reference/edibnb.html).

# Exercises

```{marginfigure}
**Hint:** The Markdown Quick Reference sheet has an example of inline R code that might be helpful. You can access it from the Help menu in RStudio.
```

1.  How many observations (rows) does the dataset have? Instead of hard coding the number in your answer, use inline code.

**Hint:** In your answer, type a backtick, then r, then space, then `nrow(edibnb)`, then close with another backtick. When you knit, this will show the actual number instead of the code.


2.  Run `View(edibnb)` in your Console to view the data in the data viewer. What does each row in the dataset represent?

*After completing Exercises 1-2:*

ðŸ§¶ Knit â†’ âœ… Commit with message `"Completed Exercises 1-2"` â†’ â¬†ï¸ Push

Each column represents a variable. We can get a list of the variables in the data frame using the `names()` function.

```{r}
names(edibnb)
```

You can find descriptions of each of the variables in the help file for the dataset, which you can access by running `?edibnb` in your Console.


--- 

Before you create your first plot, let's understand the structure of ggplot2 code. Here's the basic template:
```{r example-plot}
ggplot(data = dataset_name, mapping = aes(x = variable)) +
  geom_histogram(binwidth = 50) +
  facet_wrap(~grouping_variable)
```

**Breaking it down:**

- `ggplot()` starts the plot and defines the data and aesthetic mappings
- `geom_histogram()` adds the geometric layer (histogram bars)
- `facet_wrap()` creates separate plots for each group
- Each layer is connected with `+`

---

3.  Create a faceted histogram where each facet represents a neighborhood and displays the distribution of Airbnb prices in that neighborhood.

  a) Experiment with binwidth

Try binwidths of 25, 50, and 100. Which gives you the most useful view of the data?
```{r price-hist-experiments}
# Try binwidth = 25
ggplot(data = edibnb, mapping = aes(x = price)) +
  geom_histogram(binwidth = 25) +
  facet_wrap(~neighbourhood)

# Try binwidth = 50


# Try binwidth = 100
```

*Which binwidth did you choose and why?*

 b) Experiment with facet layout*

Try these three options:

- `facet_wrap(~neighbourhood)` - wraps into a grid
- `facet_wrap(~neighbourhood, ncol = 1)` - stacks vertically  
- `facet_wrap(~neighbourhood, nrow = 1)` - arranges horizontally

*Which layout did you choose and why?*

 c) Create your final visualization

```{marginfigure}
**Note:** The plot will give a warning about some observations with non-finite values for price being removed. Don't worry about the warning, it simply means that 199 listings in the data didn't have prices available, so they can't be plotted.
```

Use your chosen binwidth and layout:
```{r final-price-histogram, eval = FALSE}
# Your final code here
```

*After completing Exercise 3:*

ðŸ§¶ Knit â†’ âœ… Commit with message `"Completed Exercise 3"` â†’ â¬†ï¸ Push

4.  This question has three parts that work together to explore the top 5 most expensive neighborhoods.

  a) Identify the top 5 neighborhoods by median price. Complete the pipeline to find neighborhoods with the highest median prices:
  
```{r top-5-neighborhoods, eval = FALSE}
top_5 %
  group_by(___) %>%
  summarise(median_price = median(___, na.rm = TRUE)) %>%
  arrange(desc(___)) %>%
  slice_max(___, n = ___)

top_5
```

  b) Create ridge plots for these neighborhoods. 
  
  Ridge plots show distributions stacked vertically, making them easy to compare.
```{r ridge-plots, message = FALSE, eval = FALSE}
library(ggridges)

# Filter for top 5 neighborhoods and create ridge plot
edibnb %>%
  filter(neighbourhood %in% ___$___) %>%
  ggplot(aes(x = ___, y = ___)) +
  geom_density_ridges() +
  labs(
    x = "___",
    y = "___",
    title = "___"
  )
```

  c) Calculate the summary statistics.
  
```{r summary-stats, eval = FALSE}
edibnb %>%
  filter(neighbourhood %in% ___$___) %>%
  group_by(___) %>%
  summarise(
    min = min(___, na.rm = TRUE),
    mean = mean(___, na.rm = TRUE),
    median = ___,
    sd = ___,
    IQR = ___,
    max = ___
  )
```

Using both the visualization and summary statistics, describe the distribution of listing prices in these neighborhoods. Consider:

- Which neighborhood has the highest typical prices?
- Which has the most variation (spread) in prices?
- Are there any notable patterns or outliers?

*After completing Exercise 4:*

ðŸ§¶ Knit â†’ âœ… Commit with message `"Completed Exercise 4"` â†’ â¬†ï¸ Push

5.  Create a visualization that will help you compare the distribution of review scores (`review_scores_rating`) across neighborhoods. You get to decide what type of visualization to create and there is more than one correct answer! 

*Suggested plot types to consider:*

- Box plots: `geom_boxplot()`
- Violin plots: `geom_violin()`
- Faceted histograms: `geom_histogram()` + `facet_wrap()`
- Ridge plots: `geom_density_ridges()` (requires `library(ggridges)`)


```{r review-scores-viz, eval = FALSE}
# Your code here
```

*Interpretation (2-3 sentences):*

- How do Airbnb guests rate properties in general (are ratings generally high, low, or varied)?
- How do the neighborhoods compare to each other?
- Are there any neighborhoods that stand out as having particularly high or low ratings?

*After completing Exercise 5:*

ðŸ§¶ Knit â†’ âœ… Commit with message `"Completed Exercise 5"` â†’ â¬†ï¸ Push

---

## Common Errors and Troubleshooting

**Visualization errors:**

- **Error: "object not found"** â†’ Make sure you loaded the tidyverse package with `library(tidyverse)`
- **Facets are too small to read** â†’ Try different layouts with `ncol` or `nrow` arguments in `facet_wrap()`
- **Warning about non-finite values** â†’ This is normal for this dataset (some prices are missing)
- **Error: "could not find function 'geom_density_ridges'"** â†’ Load the ggridges package: `library(ggridges)`

**Pipeline errors:**

- **Error: "could not find function '%>%'"** â†’ Load the tidyverse package
- **`group_by()` not working as expected** â†’ Make sure you use `summarise()` after `group_by()`
- **Can't filter for top 5 neighborhoods** â†’ Make sure you're using `top_5$neighbourhood` to reference the neighborhood names

**Inline code issues:**

- **Inline code shows as text** â†’ Make sure you're using backticks around your R code (backtick-r-space-your-code-backtick) 
- **Error when knitting** â†’ Check that the variable/function you're referencing exists

**General issues:**

- **Plot not showing** â†’ Make sure the code chunk doesn't have `eval = FALSE`
- **Changes not showing after knitting** â†’ Save your file first (Ctrl+S or Cmd+S)

---


**To submit:**

1. Click the **Knit** dropdown menu (next to the Knit button)
2. Select **Knit to tufte_handout** to generate a PDF
3. Download the PDF file from your Files pane
4. Upload the PDF to Canvas

**âœ“ Final check:** Visit your GitHub repo to confirm all your commits are there!